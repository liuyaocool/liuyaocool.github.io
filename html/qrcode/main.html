<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>analyse QR Code</title>
    <link rel="stylesheet" href="../../css/theme.css"/>

    <style>
        body, html{
            padding: 0;
            margin: 0;
            height: 100%;
        }

        body {
            text-align: center;
        }

        body *{
            font-weight: bold;
        }

        textarea {
            min-width: 90%;
            max-width: 90%;
            min-height: 16vh;
            line-height: 3vh;
            font-size: 2vh;
        }

        button {
            font-size: 3vh;
            border-width: 0.5vh;
        }

        #qrcode canvas {
            display: none;
        }

        #delib2 {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 12px;
            color: gray;
        }

        .show {
            width: 49%;
            margin: 10px 0;
            padding: 10px 0;
            border-style: solid;
            border-color: white;
        }

        .img-div {
            width: 300px;
            margin: 10px calc(50% - 160px);
            border: 10px solid white;
        }
        .img-div img{
            width: 100%;
            display: block;
        }

        table {
            border-collapse: collapse;
        }
        .grid{
            display: flex;
            flex-direction: row;
            /* align-items: flex-end; 底部对齐 */
            /* justify-content: center; 水平居中对齐 */
        }
        .top {
            align-self: flex-start; /* 顶部对齐 */
        }
        .bottom {
            align-self: flex-end; /* 底部对齐 */
        }
    </style>

</head>
<body>

    <span id="delib2"></span>
    <div style="height: 30px;"></div>

    <textarea id="url" placeholder="input string here"></textarea>
    <table style="width: 100%;margin: 10px 0;"><tr>
        <td style="width: 50%; border-right: 1px solid white; border-bottom: 1px solid white;vertical-align: top;">
            <button type="button" onclick="generate()">Generate</button>
            <div id="qrcode" class="img-div"></div>
        </td>
        <td style="border-top: 1px solid white;vertical-align: bottom;">
            <div class="img-div">
                <img id="uploadPic">
            </div>
            <button type="button" onclick="analyzeChoose()">Analyze</button>    
        </td>
    </tr></table>
    <textarea id="result" placeholder="the analyzed results are shown here (suport clipboard)"></textarea>


    <script src="../../js/config.js"></script>
    <script src="../../js/base.js"></script>

    <script src="https://hello-4bi.pages.dev/jslib/qrcode/en/qrcode.min.js"></script>

    <!-- <script src="../../jslib/qrcode/delib1/jimp.js"></script> -->
    <script src="https://hello-4bi.pages.dev/jslib/qrcode/delib1/jsQR.js"></script>

    <script src="https://hello-4bi.pages.dev/jslib/qrcode/delib2/cli-qrcode.js"></script>
    <script src="https://hello-4bi.pages.dev/jslib/qrcode/delib2/qr-cli.js"></script>

    <script src="main.js"></script>


    <script>
        let opcvJsUrl = '../../jslib/qrcode/delib2/oepncv.js';
        // opcvJsUrl = 'https://cdn.jsdelivr.net/gh/liuyaocool/hello/jslib/qrcode/delib2/oepncv.js';
        // opcvJsUrl = 'https://static.clewm.net/cli/js/decode/oepncv.js';

        // let opcvCacheKey = 'opcv_';
        // if(!localStorage.getItem(opcvCacheKey + 1)) {
        //     let partLen = 1024 * 1024;
        //     fetch(opcvJsUrl).then(res => {
        //         if(!res.ok) return;
        //         res.text().then(getText => {
        //             for (let i = 0; ; i++) {
        //                 let jsPart = getText.substr(partLen * i, partLen)
        //                 if (!jsPart) break;
        //                 localStorage.setItem(opcvCacheKey + i, jsPart);
        //             }
        //             eval(getText);
        //         });
        //     })
        // } else {
        //     let opcvJs = '';
        //     for (let i = 0; ; i++) {
        //         if (!localStorage.getItem(opcvCacheKey + i)) break;
        //         opcvJs += localStorage.getItem(opcvCacheKey + i);
        //     }
        //     eval(opcvJs);
        // }

        // 用此方法才能做到异步
        // document.getElementById('delib2').innerText = 'analyze enhance libiary loading...';
        // asyncLoadJs(opcvJsUrl, (e, cost) => {
        //     document.getElementById('delib2').innerText = `analyze enhance libiary load ok ${cost / 1000}s`;
        // });
    </script>

    <!-- defer 也不会让父页面认为此页面加载完毕 -->
    <!-- <script src="https://static.clewm.net/cli/js/decode/oepncv.js" defer></script> -->
    <script src="https://hello-4bi.pages.dev/jslib/qrcode/delib2/oepncv.js" defer></script>
    <!-- <script src="https://hello.61linux.com/jslib/qrcode/delib2/oepncv.js" defer></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/gh/liuyaocool/hello/jslib/qrcode/delib2/oepncv.js" defer></script> -->

</body>
</html>