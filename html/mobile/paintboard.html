<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>移动画板</title>
<style>
    body {
        margin: 0;
        padding: 0;
        overflow: hidden;
    }

    canvas {
        display: block;
        margin: auto;
        background-color: #f0f0f0;
        touch-action: none;
    }
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
    class LinePainter {
        constructor(ctx, viewCtx) {
            this.ctx = ctx;
            this.viewCtx = viewCtx;
            this.ps = [];
        }

        start(x, y) {
            this.ps.push([x, y]);
            this.ctx.beginPath();
            this.ctx.moveTo(x, y);
            return this;
        }

        move(x, y) {
            this.ps.push([x, y]);
            this.ctx.lineTo(x, y);
            this.ctx.stroke();
            return this;
        }

        end() {
            this.ctx.closePath();
            return this;
        }

        repaint() {
            this.ctx.beginPath();
            this.ctx.moveTo(this.ps[0][0], this.ps[0][1]);
            for (let i = 1; i < this.ps.length; i++) {
                ctx.lineTo(this.ps[i][0], this.ps[i][1]);
            }
            this.ctx.stroke();
            this.ctx.closePath();
            return this;
        }
    }

</script>


<script>

    /**
     * 可以做两层画布 一层绘制(可实时清空 实线画园效果) 一层显示效果
     */
    
    const canvas = document.getElementById('canvas');
    // 设置canvas大小
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    const ctx = canvas.getContext('2d');
    ctx.strokeStyle = '#000'; // 画笔颜色
    ctx.lineWidth = 1; // 画笔粗细
    ctx.lineCap = 'round'; // 画笔形状
    
    // [{type: data}]
    const hisPainter = [];
    let painterTypes = {
        "line": LinePainter
    };
    let curType = 'line';
    let curPainter; // 切换图形时初始化
    
    let isDrawing = false;
    
    function startDrawing(e) {
        [x, y] = [e.touches[0].clientX, e.touches[0].clientY];
        curPainter = new painterTypes[curType](ctx, null).start(x, y);
    }
    function draw(e) {
        [x, y] = [e.touches[0].clientX, e.touches[0].clientY];
        console.log(`${curPainter ? 1 : 0} ${x} / ${y}`);
        if (curPainter) curPainter.move(x, y);
    }
    function stopDrawing(e) {
        if (curPainter) hisPainter.push(curPainter.end());
        curPainter = null;
    }
    
    canvas.addEventListener('touchstart', function(e) {
        switch(e.touches.length) {
            case 1: startDrawing(e); break;
            case 2: 
                break;
            default:
        }
    });
    canvas.addEventListener('touchmove', function(e) {
        switch(e.touches.length) {
            case 1: draw(e); break;
            case 2: 
                break;
            default:
        }
    });
    canvas.addEventListener('touchend', function(e) {
        stopDrawing(e);
        console.log('touchend');
        // e.touches.length --> 0
        // e.changedTouches.length --> 1
    });
    
    
        // // 双指缩放
        // let pinchStartDistance = 0;
    
        // canvas.addEventListener('touchstart', function(event) {
        //     if (event.touches.length === 2) {
        //         const touch1 = event.touches[0];
        //         const touch2 = event.touches[1];
        //         pinchStartDistance = Math.hypot(touch2.clientX - touch1.clientX, touch2.clientY - touch1.clientY);
        //     }
        // });
    
        // canvas.addEventListener('touchmove', function(event) {
        //     if (event.touches.length === 2) {
        //         const touch1 = event.touches[0];
        //         const touch2 = event.touches[1];
        //         const pinchDistance = Math.hypot(touch2.clientX - touch1.clientX, touch2.clientY - touch1.clientY);
        //         const scale = pinchDistance / pinchStartDistance;
        //         context.scale(scale, scale);
        //         pinchStartDistance = pinchDistance;
        //     }
        // });
    
        // canvas.addEventListener('touchend', function(event) {
        //     if (event.touches.length < 2) {
        //         context.setTransform(1, 0, 0, 1, 0, 0);
        //     }
        // });
    
    </script>
    
</body>
</html>